/*
* uxCommandMap v.0.1.0
* (c) 2013, WebUX
* http://webux.github.io
* License: MIT
*/
!function(a,b){b.ux=a,function(a,b){function c(a,b){this.commands=a,this.args=b.splice(0)}function d(){this._mappings={}}function e(){this._commands=[]}b.ux=a,c.counter=0,c.prototype.execute=function(a){var b,c=this;this.commands.length?(b=this.next(c.commands.shift()),b.then(function(){c.execute(a)})):a()},c.prototype.next=function(a){var b,d=h.defer();if(d.__uid=c.counter+=1,a="function"==typeof a?new a:angular.clone(a),void 0===a.execute)throw new Error('Command expects "execute" to be defined.');if("function"!=typeof a.execute)throw new Error('Command expects "execute" to be of type function.');return"complete"in a?(b=a.complete,a.complete=function(){b.apply(a),"destruct"in a&&a.destruct(),d.resolve(),g.$$phase||g.$apply()}):a.complete=function(){"destruct"in a&&a.destruct(),d.resolve()},"construct"in a&&a.construct.apply(a,this.args),a.execute.apply(a,this.args),void 0===b&&a.complete(),d.promise},d.prototype.map=function(a){if("string"!=typeof a)throw new Error("Event must of type string.");if(!a.length)throw new Error("Event string cannot be empty");var b=this;return this._mappings[a]||(this._mappings[a]=new e,this._mappings[a].unsubscribe=g.$on(a,function(){var d,e,f;d=Array.prototype.slice.call(arguments),d.shift(),e=b._mappings[a],e.commandExecutor||(e.commandExecutor=new c(e.getCommands(),d),e.commandExecutor.execute(function(){delete e.commandExecutor,f=null}))})),this._mappings[a]},d.prototype.unmap=function(a,b){this._mappings[a]&&(this._mappings[a].fromCommand(b),this._mappings[a].isEmpty()&&(this._mappings[a].unsubscribe(),delete this._mappings[a]))},d.prototype.umapAll=function(){this._mappings={}},e.prototype.getCommands=function(){return this._commands.splice(0)},e.prototype.isEmpty=function(){return 0===this._commands.length},e.prototype.hasCommand=function(a){for(var b=this._commands.length;b--;)if(this._commands[b]===a)return!0;return!1},e.prototype.toCommand=function(a){this.hasCommand(a)||this._commands.push(a)},e.prototype.fromCommand=function(a){for(var b=this._commands.length;b--;)if(this._commands[b]===a){this._commands.splice(b,1);break}};try{angular.module("ux")}catch(f){angular.module("ux",[])}var g,h;angular.module("ux").factory("commandMap",["$rootScope","$q",function(a,b){return g=a,h=b,new d}])}({},function(){return this}())}({},function(){return this}());